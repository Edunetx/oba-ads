<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OBA-ADS Signup</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: #fff;
  }
  .card {
    background: linear-gradient(135deg, #1a1a1a, #333);
    border-radius: 12px;
    padding: 28px;
    width: 90%;
    max-width: 360px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    text-align: center;
    animation: rise 0.6s ease;
  }
  input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 16px;
  }
  button {
    padding: 12px;
    width: 100%;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg,#ff416c,#ff4b2b);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }
  button:hover {
    transform: scale(1.05);
  }
  .msg {
    margin: 8px 0;
    padding: 8px;
    border-radius: 6px;
    font-size: 14px;
  }
  .msg.success { background: #1e8e3e; }
  .msg.error { background: #c0392b; }
  a { color: #ff4b2b; text-decoration: none; }
  @keyframes rise { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity:1; } }
  body, input, button, .msg { user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; }
</style>
</head>
<body>
<div class="card">
  <h2>OBA-ADS Signup</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <input type="text" id="referral" placeholder="Referral (Optional)">
  <button id="signupBtn">Sign Up</button>
  <div class="msg" id="msg" style="display:none;"></div>
  <p>Already have an account? <a href="login.html">Login</a></p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAqcoCo_V68ILJReJ2WNDUhlMvoH_FbQn4",
  authDomain: "oba-ads.firebaseapp.com",
  projectId: "oba-ads",
  storageBucket: "oba-ads.firebasestorage.app",
  messagingSenderId: "801050707463",
  appId: "1:801050707463:web:6eb31025639431e197cca2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

document.getElementById('signupBtn').addEventListener('click', async () => {
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  let referral = document.getElementById('referral').value.trim() || "OBA";
  const msgEl = document.getElementById('msg');

  if(!username || !email || !password) {
    msgEl.style.display="block";
    msgEl.className="msg error";
    msgEl.textContent="All fields are required";
    return;
  }

  try {
    // Check if username exists
    const usernameSnap = await db.collection("users").where("username","==",username).get();
    if(!usernameSnap.empty){
      msgEl.style.display="block";
      msgEl.className="msg error";
      msgEl.textContent="Username already taken";
      return;
    }

    // Create Auth user
    const cred = await auth.createUserWithEmailAndPassword(email,password);
    const uid = cred.user.uid;

    // Create Firestore document
    await db.collection("users").doc(uid).set({
      username: username,
      email: email,
      balance: 1, // signup bonus
      totalEarnings: 1,
      referredBy: referral,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    msgEl.style.display="block";
    msgEl.className="msg success";
    msgEl.textContent="Account created successfully!";

    // Optionally redirect after 2s
    setTimeout(()=>{ window.location="login.html"; },2000);
  } catch (error) {
    msgEl.style.display="block";
    msgEl.className="msg error";
    msgEl.textContent=error.message;
    console.error(error);
  }
});
</script>
</body>
</html>
