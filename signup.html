<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OBA-ADS Signup</title>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    height: 100vh;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
    user-select: none; /* disable copy */
  }

  .card {
    width: 92%;
    max-width: 360px;
    background: rgba(255,255,255,0.06);
    padding: 28px;
    border-radius: 14px;
    text-align: center;
    backdrop-filter: blur(12px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    animation: rise 0.6s ease;
  }

  @media screen and (min-width: 768px) {
    .card {
      max-width: 480px;
      padding: 36px;
    }
  }

  @keyframes rise {
    from {opacity:0; transform: translateY(40px);}
    to {opacity:1; transform: translateY(0);}
  }

  input {
    width: 90%;
    padding: 12px;
    margin: 12px 0;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    background: rgba(255,255,255,0.15);
    color: #fff;
  }

  input::placeholder {
    color: rgba(255,255,255,0.7);
  }

  button {
    width: 94%;
    padding: 12px;
    margin-top: 16px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, #ff8c00, #ff0080);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.5);
  }

  .msg {
    margin-top: 12px;
    font-size: 14px;
    user-select: none; /* prevent copying */
  }

  .msg p.error { color: #ff4d4f; }
  .msg p.success { color: #00ff99; }

  .login-link {
    margin-top: 14px;
    display: block;
    color: #aaa;
    text-decoration: none;
    font-size: 14px;
  }

  .login-link:hover { text-decoration: underline; }
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
<div class="card">
  <h2>OBA-ADS Signup</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password (min 6 chars)">
  <input type="text" id="referral" placeholder="Referral (optional)">
  <button onclick="signup()">Sign Up</button>
  <div class="msg" id="msg"></div>
  <a href="login.html" class="login-link">Already have an account? Login</a>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAqcoCo_V68ILJReJ2WNDUhlMvoH_FbQn4",
    authDomain: "oba-ads.firebaseapp.com",
    projectId: "oba-ads",
    storageBucket: "oba-ads.firebasestorage.app",
    messagingSenderId: "801050707463",
    appId: "1:801050707463:web:6eb31025639431e197cca2"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  async function signup() {
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const referral = document.getElementById("referral").value.trim();
    const msg = document.getElementById("msg");

    if (!username || !email || !password) {
      msg.innerHTML = "<p class='error'>All fields are required.</p>";
      return;
    }
    if (password.length < 6) {
      msg.innerHTML = "<p class='error'>Password must be at least 6 characters.</p>";
      return;
    }

    try {
      // Check if username already exists
      const userCheck = await db.collection("users").where("username", "==", username).get();
      if (!userCheck.empty) {
        msg.innerHTML = "<p class='error'>Username already taken, choose another one.</p>";
        return;
      }

      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const user = userCredential.user;

      let bonus = 0;
      let referredBy = referral || "OBA";
      if (referredBy) bonus = 1;

      await db.collection("users").doc(user.uid).set({
        username,
        email,
        balance: bonus,
        totalEarnings: bonus,
        referredBy,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      msg.innerHTML = "<p class='success'>Account created successfully. Redirecting...</p>";
      setTimeout(() => {
        window.location.href = "login.html";
      }, 2000);
    } catch (error) {
      let errorMsg = "Something went wrong. Try again.";
      if (error.code === "auth/email-already-in-use") {
        errorMsg = "This email is already registered.";
      } else if (error.code === "auth/invalid-email") {
        errorMsg = "Invalid email format.";
      } else if (error.code === "auth/weak-password") {
        errorMsg = "Password too weak.";
      }
      msg.innerHTML = `<p class='error'>${errorMsg}</p>`;
    }
  }
</script>
</body>
</html>
